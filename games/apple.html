<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ¥è˜‹æœéŠæˆ²</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    canvas {
      border: 2px solid #444;
      background: #eef;
      margin-top: 10px;
    }
    #info {
      font-size: 18px;
      margin: 10px;
    }
    #info select {
      font-size: 16px;
    }
    #instructions {
      margin: 20px auto;
      width: 80%;
      padding: 12px;
      background: #fff3cd;
      border: 1px solid #ffeeba;
      border-radius: 8px;
      text-align: left;
      font-size: 16px;
    }
    #instructions ul {
      padding-left: 1.2em;
    }
  </style>
</head>
<body>
  <h2>ğŸ æ¥è˜‹æœéŠæˆ²</h2>

  <div id="info">
    ç”Ÿå‘½å€¼: <span id="lives">10</span> |
    æ¨¡å¼:
    <select id="modeSelect" onkeydown="return false;">
      <option value="normal">æ™®é€š</option>
      <option value="hard">å›°é›£</option>
    </select>
  </div>

  <canvas id="gameCanvas" width="600" height="400"></canvas>

  <div id="instructions">
    <strong>ğŸ® éŠæˆ²èªªæ˜ï¼š</strong>
    <ul>
      <li>ä½¿ç”¨éµç›¤ <strong>â†</strong> èˆ‡ <strong>â†’</strong> ç§»å‹•ç±ƒå­æ¥ä½è˜‹æœ</li>
      <li>ğŸ <strong>æ™®é€šè˜‹æœï¼š</strong> +1 ç”Ÿå‘½å€¼</li>
      <li>ğŸ <strong>é‡‘è˜‹æœï¼š</strong> +2 ç”Ÿå‘½å€¼</li>
      <li>â˜ ï¸ <strong>æ¯’è˜‹æœï¼š</strong> -1 ç”Ÿå‘½å€¼</li>
      <li>æ™®é€šæ¨¡å¼ï¼šé”åˆ° <strong>50</strong> ç”Ÿå‘½å€¼é€šé—œ</li>
      <li>å›°é›£æ¨¡å¼ï¼šé”åˆ° <strong>100</strong> ç”Ÿå‘½å€¼é€šé—œï¼ˆæ¯’è˜‹æœå‡ºç¾æ›´å¤šï¼‰</li>
      <li>ç”Ÿå‘½å€¼æ­¸é›¶éŠæˆ²çµæŸ</li>
    </ul>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let player = { x: 280, width: 60 };
    let apples = [];
    let lives = 10;
    let mode = 'normal';
    let goal = 50;
    let gameOver = false;

    const modeSelect = document.getElementById("modeSelect");
    const livesDisplay = document.getElementById("lives");

    modeSelect.addEventListener("change", () => {
      mode = modeSelect.value;
      resetGame();
    });

    document.addEventListener("keydown", (e) => {
      modeSelect.blur(); // é¿å…æ–¹å‘éµåˆ‡æ›æ¨¡å¼é¸å–®

      if (e.key === "ArrowLeft") player.x -= 20;
      if (e.key === "ArrowRight") player.x += 20;
      player.x = Math.max(0, Math.min(player.x, canvas.width - player.width));
    });

    function resetGame() {
      lives = 10;
      goal = mode === "normal" ? 50 : 100;
      apples = [];
      gameOver = false;
      livesDisplay.textContent = lives;
    }

    function spawnApple() {
      const rand = Math.random();
      let type = "normal";

      if (mode === "hard") {
        if (rand < 0.5) type = "poison";
        else if (rand < 0.6) type = "gold";
      } else {
        if (rand < 0.1) type = "poison";
        else if (rand < 0.2) type = "gold";
      }

      apples.push({
        x: Math.random() * (canvas.width - 20),
        y: 0,
        type: type
      });
    }

    function updateGame() {
      if (gameOver) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ç©å®¶
      ctx.fillStyle = "#444";
      ctx.fillRect(player.x, canvas.height - 20, player.width, 10);

      // è˜‹æœ
      for (let i = apples.length - 1; i >= 0; i--) {
        let apple = apples[i];
        apple.y += 3;

        if (apple.type === "poison") ctx.fillStyle = "purple";
        else if (apple.type === "gold") ctx.fillStyle = "gold";
        else ctx.fillStyle = "red";

        ctx.beginPath();
        ctx.arc(apple.x, apple.y, 10, 0, Math.PI * 2);
        ctx.fill();

        // ç¢°åˆ°ç©å®¶
        if (
          apple.y >= canvas.height - 30 &&
          apple.x >= player.x &&
          apple.x <= player.x + player.width
        ) {
          if (apple.type === "poison") lives -= 1;
          else if (apple.type === "gold") lives += 2;
          else lives += 1;
          apples.splice(i, 1);
          continue;
        }

        // è¶…å‡ºç•«é¢
        if (apple.y > canvas.height) {
          apples.splice(i, 1);
        }
      }

      livesDisplay.textContent = lives;

      if (lives <= 0) {
        alert("ğŸ’€ ä½ è¢«æ¯’è˜‹æœæ¯’æ­»äº†ï¼ŒéŠæˆ²çµæŸï¼");
        gameOver = true;
        resetGame();
      } else if (lives >= goal) {
        alert(`ğŸ‰ æ­å–œä½ é”åˆ° ${goal} ç”Ÿå‘½å€¼ï¼Œé€šé—œæˆåŠŸï¼`);
        gameOver = true;
        resetGame();
      }
    }

    // éŠæˆ²è¿´åœˆèˆ‡è˜‹æœç”Ÿæˆ
    setInterval(() => {
      if (!gameOver && Math.random() < 0.25) spawnApple();
    }, 400);
    setInterval(updateGame, 30);
  </script>
</body>
</html>
